"use strict";(self.webpackChunkapi_laravel_doc=self.webpackChunkapi_laravel_doc||[]).push([[2],{3905:(e,a,n)=>{n.d(a,{Zo:()=>d,kt:()=>k});var o=n(7294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function t(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?t(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,o,r=function(e,a){if(null==e)return{};var n,o,r={},t=Object.keys(e);for(o=0;o<t.length;o++)n=t[o],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(o=0;o<t.length;o++)n=t[o],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),p=function(e){var a=o.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},d=function(e){var a=p(e.components);return o.createElement(i.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},u=o.forwardRef((function(e,a){var n=e.components,r=e.mdxType,t=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),u=r,k=c["".concat(i,".").concat(u)]||c[u]||m[u]||t;return n?o.createElement(k,s(s({ref:a},d),{},{components:n})):o.createElement(k,s({ref:a},d))}));function k(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var t=n.length,s=new Array(t);s[0]=u;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l[c]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<t;p++)s[p]=n[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3092:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>m,frontMatter:()=>t,metadata:()=>l,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const t={sidebar_position:10},s="\ud83d\udcd6Backup y restauraci\xf3n de la base datos",l={unversionedId:"BacKend/comandos",id:"BacKend/comandos",title:"\ud83d\udcd6Backup y restauraci\xf3n de la base datos",description:"En este apartado desarrollaremos un sistema de Backups autom\xe1ticos, programables y restauraci\xf3n. Para ello crearemos nuestros propios comandos artisan y aprenderemos a utilizar el programador de tareas.",source:"@site/docs/BacKend/comandos.md",sourceDirName:"BacKend",slug:"/BacKend/comandos",permalink:"/api_cervezas_doc/docs/BacKend/comandos",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/BacKend/comandos.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"\ud83d\udcd6Rellenando la BB.DD",permalink:"/api_cervezas_doc/docs/BacKend/seeders"},next:{title:"Creaci\xf3n de una API REST en Laravel",permalink:"/api_cervezas_doc/docs/category/creaci\xf3n-de-una-api-rest-en-laravel"}},i={},p=[{value:"Introducci\xf3n a de los Comandos Personalizados en Laravel",id:"introducci\xf3n-a-de-los-comandos-personalizados-en-laravel",level:2},{value:"Creaci\xf3n del Primer Comando",id:"creaci\xf3n-del-primer-comando",level:2},{value:"Generar el Comando",id:"generar-el-comando",level:3},{value:"Definir la L\xf3gica del Comando",id:"definir-la-l\xf3gica-del-comando",level:3},{value:"Veamos punto por punto que hace el c\xf3digo:",id:"veamos-punto-por-punto-que-hace-el-c\xf3digo",level:3},{value:"\xa1Ejecuta tu Comando!",id:"ejecuta-tu-comando",level:3},{value:"Restore Database",id:"restore-database",level:2},{value:"Explicaci\xf3n del c\xf3digo:",id:"explicaci\xf3n-del-c\xf3digo",level:3}],d={toc:p},c="wrapper";function m(e){let{components:a,...n}=e;return(0,r.kt)(c,(0,o.Z)({},d,n,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"backup-y-restauraci\xf3n-de-la-base-datos"},"\ud83d\udcd6Backup y restauraci\xf3n de la base datos"),(0,r.kt)("p",null,"En este apartado desarrollaremos un sistema de Backups autom\xe1ticos, programables y restauraci\xf3n. Para ello crearemos nuestros propios comandos ",(0,r.kt)("strong",{parentName:"p"},"artisan")," y aprenderemos a utilizar el ",(0,r.kt)("strong",{parentName:"p"},"programador de tareas"),"."),(0,r.kt)("h2",{id:"introducci\xf3n-a-de-los-comandos-personalizados-en-laravel"},"Introducci\xf3n a de los Comandos Personalizados en Laravel"),(0,r.kt)("p",null,"Los comandos personalizados en Laravel son una caracter\xedstica fundamental para desarrolladores y proyectos de Laravel. Proporcionan una forma eficiente de automatizar tareas, interactuar con la aplicaci\xf3n y ejecutar scripts personalizados desde la l\xednea de comandos. A continuaci\xf3n, destacamos la importancia de los comandos personalizados en Laravel:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Automatizaci\xf3n de Tareas"),": Los comandos personalizados permiten automatizar tareas repetitivas. Puedes crear comandos que realicen tareas como la generaci\xf3n de informes, la limpieza de registros antiguos en la base de datos o la ejecuci\xf3n de procesos programados.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Mejora de la Productividad"),": Al automatizar tareas comunes, los desarrolladores pueden ahorrar tiempo y esfuerzo. Esto mejora la productividad general al liberar a los equipos de desarrollo de tareas manuales que consumen mucho tiempo.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Flexibilidad y Personalizaci\xf3n"),": Laravel ofrece una estructura organizada para crear comandos personalizados. Esto brinda a los desarrolladores la flexibilidad para personalizar y extender la funcionalidad de su aplicaci\xf3n de acuerdo con las necesidades espec\xedficas del proyecto.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Interacci\xf3n con la Aplicaci\xf3n"),": Los comandos personalizados pueden interactuar con la aplicaci\xf3n de Laravel, acceder a modelos, servicios y otras partes de la aplicaci\xf3n. Esto permite la manipulaci\xf3n de datos y la realizaci\xf3n de operaciones avanzadas.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Programaci\xf3n de Tareas"),": Los comandos personalizados son esenciales para la programaci\xf3n de tareas en Laravel. Puedes programar comandos para ejecutarse autom\xe1ticamente en momentos espec\xedficos, lo que es \xfatil para la generaci\xf3n de informes diarios, la importaci\xf3n de datos peri\xf3dica, entre otros.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Consola de Desarrollo"),": Los comandos personalizados son particularmente valiosos en entornos de desarrollo y depuraci\xf3n. Los desarrolladores pueden utilizar la consola de comandos para probar funciones, depurar problemas y realizar operaciones espec\xedficas sin necesidad de interactuar con la interfaz web.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Integraci\xf3n con Otras Herramientas"),": Los comandos personalizados son la base para la integraci\xf3n de Laravel con otras herramientas y servicios. Puedes crear comandos que se conecten a API externas, generen respuestas en formato JSON o realicen copias de seguridad autom\xe1ticas.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Escalabilidad"),": A medida que un proyecto de Laravel crece, la automatizaci\xf3n se vuelve a\xfan m\xe1s importante. Los comandos personalizados permiten que una aplicaci\xf3n siga siendo escalable al manejar tareas adicionales sin aumentar la carga manual de trabajo.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Claridad y Documentaci\xf3n del C\xf3digo"),": Al encapsular tareas en comandos personalizados, el c\xf3digo de la aplicaci\xf3n se vuelve m\xe1s claro y organizado. Los comandos pueden servir como una forma de documentaci\xf3n viva que muestra c\xf3mo se ejecutan tareas espec\xedficas."))),(0,r.kt)("p",null,"Como conclusi\xf3n, los comandos personalizados en Laravel son una herramienta poderosa para mejorar la eficiencia, la productividad y la calidad del c\xf3digo. Su versatilidad los hace esenciales para el desarrollo de aplicaciones web robustas y altamente funcionales. Con el conocimiento de c\xf3mo crear y utilizar comandos personalizados en Laravel, los desarrolladores pueden llevar sus proyectos al siguiente nivel."),(0,r.kt)("h2",{id:"creaci\xf3n-del-primer-comando"},"Creaci\xf3n del Primer Comando"),(0,r.kt)("p",null,"Una de las primeras y m\xe1s emocionantes experiencias al trabajar con Laravel es la creaci\xf3n de tu propio comando personalizado. Estos comandos son fundamentales para automatizar tareas espec\xedficas de tu aplicaci\xf3n. Aqu\xed te guiaremos a trav\xe9s del proceso de creaci\xf3n de tu primer comando personalizado en Laravel. En este caso crearemos el comando ",(0,r.kt)("strong",{parentName:"p"},"backup-database")," encargado de generar nuestros backups de base de datos."),(0,r.kt)("h3",{id:"generar-el-comando"},"Generar el Comando"),(0,r.kt)("p",null,"Laravel facilita la creaci\xf3n de comandos personalizados mediante el generador de comandos. Abre una terminal y navega hasta el directorio ra\xedz de tu proyecto Laravel. Luego, ejecuta el siguiente comando para crear un nuevo comando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan make:command BackupDatabase\n")),(0,r.kt)("p",null,"Esto generar\xe1 un nuevo archivo de comando en el directorio ",(0,r.kt)("inlineCode",{parentName:"p"},"app/Console/Commands"),"."),(0,r.kt)("h3",{id:"definir-la-l\xf3gica-del-comando"},"Definir la L\xf3gica del Comando"),(0,r.kt)("p",null,"Abre el archivo reci\xe9n creado, ",(0,r.kt)("inlineCode",{parentName:"p"},"BackupDatabase.php"),", en tu editor de c\xf3digo favorito. En este archivo, ver\xe1s dos m\xe9todos importantes: ",(0,r.kt)("inlineCode",{parentName:"p"},"signature")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"handle"),". "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"En el m\xe9todo ",(0,r.kt)("inlineCode",{parentName:"li"},"signature"),", define el nombre y la descripci\xf3n de tu comando, as\xed como cualquier argumento o opci\xf3n que pueda aceptar. Introduzca el siguiente c\xf3digo:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"  protected $signature = 'app:backup-database';\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"En el m\xe9todo ",(0,r.kt)("inlineCode",{parentName:"li"},"handle"),", coloca la l\xf3gica principal de tu comando. Aqu\xed es donde se ejecutar\xe1n las acciones espec\xedficas cuando se invoque el comando. Introduzca el siguiente c\xf3digo:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="C\xf3digo definitivo"',title:'"C\xf3digo','definitivo"':!0},"<?php\n\nnamespace App\\Console\\Commands;\n\nuse Illuminate\\Console\\Command;\nuse Symfony\\Component\\Process\\Process;\n\nclass BackupDatabase extends Command\n{\n    protected $signature = 'app:backup-database';\n\n   \n    protected $description = 'Backup the database using mysqldump';\n\n    /**\n     * Execute the console command.\n     */\n    public function handle()\n    {\n        // Genera un nombre de archivo para el respaldo basado en la fecha y hora\n        $filename = 'backup-' . date('d-m-Y-His') . '.sql';\n\n        // Crea un nuevo proceso para ejecutar mysqldump\n        $process = new Process([\n            'mysqldump',\n        //    '--routines',\n            '-h' . config('database.connections.mysql.host'),\n            '-P' . config('database.connections.mysql.port'),\n            '-u' . config('database.connections.mysql.username'),\n            '-p' . config('database.connections.mysql.password'),\n            config('database.connections.mysql.database'),\n        ]);\n\n        // Ejecuta el proceso y redirige la salida al archivo\n        $process->run();\n\n        // Verifica si el proceso fue exitoso\n        if ($process->isSuccessful()) {\n            $this->info('Backup creado correctamente: ' . $filename);\n        } else {\n            $this->error('El backup fallo: ' . $process->getErrorOutput());\n        }\n\n        // Obtiene la salida del proceso\n        $output = $process->getOutput();\n        echo $output;\n        // Obt\xe9n la ruta base de tu proyecto\n        $basePath = base_path();\n\n        // Define la ruta relativa a la carpeta de respaldo\n        $relativePath = 'app/backup/' . $filename;\n\n        // Combina la ruta base con la ruta relativa\n        $file_path = $basePath . '/' . $relativePath;\n        echo $file_path;\n\n        // Guarda la salida del proceso en el archivo\n        file_put_contents($file_path, $output);\n    }\n}\n")),(0,r.kt)("h3",{id:"veamos-punto-por-punto-que-hace-el-c\xf3digo"},"Veamos punto por punto que hace el c\xf3digo:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Definici\xf3n del Comando Personalizado")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"protected $signature = 'app:backup-database';\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Aqu\xed, estamos definiendo el nombre del comando personalizado que se utilizar\xe1 para invocar este script desde la l\xednea de comandos. En este caso, el nombre del comando es ",(0,r.kt)("inlineCode",{parentName:"li"},"app:backup-database"),"."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Descripci\xf3n del Comando")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"protected $description = 'Backup the database using mysqldump';\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Esta l\xednea proporciona una breve descripci\xf3n del prop\xf3sito del comando, que se mostrar\xe1 cuando los usuarios consulten la lista de comandos disponibles."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Funci\xf3n ",(0,r.kt)("inlineCode",{parentName:"strong"},"handle")," para Ejecutar el Comando")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"public function handle()\n{\n    // L\xf3gica para realizar el respaldo de la base de datos\n}\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"La funci\xf3n ",(0,r.kt)("inlineCode",{parentName:"li"},"handle")," es el coraz\xf3n del comando personalizado y contiene la l\xf3gica para realizar el respaldo de la base de datos."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Generaci\xf3n del Nombre del Archivo de Respaldo")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$filename = 'backup-' . date('d-m-Y-His') . '.sql';\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Aqu\xed, generamos un nombre de archivo para el respaldo de la base de datos que incluye la fecha y hora actual en el formato ",(0,r.kt)("inlineCode",{parentName:"li"},"d-m-Y-His"),". Esto asegura que cada respaldo tenga un nombre \xfanico."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Creaci\xf3n de un Proceso para Ejecutar ",(0,r.kt)("inlineCode",{parentName:"strong"},"mysqldump"))),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$process = new Process([\n    'mysqldump',\n    '-h' . config('database.connections.mysql.host'),\n    '-P' . config('database.connections.mysql.port'),\n    '-u' . config('database.connections.mysql.username'),\n    '-p' . config('database.connections.mysql.password'),\n    config('database.connections.mysql.database'),\n]);\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Creamos un nuevo proceso utilizando la biblioteca Symfony Process. Este proceso ejecutar\xe1 el comando ",(0,r.kt)("inlineCode",{parentName:"li"},"mysqldump")," con los argumentos necesarios para realizar el respaldo de la base de datos. Los valores de host, puerto, nombre de usuario, contrase\xf1a y nombre de la base de datos se obtienen de la configuraci\xf3n de Laravel."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Ejecuci\xf3n del Proceso y Redirecci\xf3n de la Salida")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$process->run();\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Ejecutamos el proceso que hemos creado y capturamos la salida. En este punto, ",(0,r.kt)("inlineCode",{parentName:"li"},"mysqldump")," se ejecuta y genera el respaldo de la base de datos."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Verificaci\xf3n de \xc9xito del Proceso")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"if ($process->isSuccessful()) {\n    // Manejo en caso de \xe9xito\n} else {\n    // Manejo en caso de error\n}\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Verificamos si el proceso fue exitoso. Si todo sali\xf3 bien, mostramos un mensaje de \xe9xito. Si hubo un error, mostramos un mensaje de error junto con la salida de error del proceso."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Obtenci\xf3n de la Salida del Proceso")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$output = $process->getOutput();\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Capturamos la salida del proceso, que contiene el contenido del respaldo de la base de datos."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Generaci\xf3n de la Ruta del Archivo de Respaldo")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"$basePath = base_path();\n$relativePath = 'app/backup/' . $filename;\n$file_path = $basePath . '/' . $relativePath;\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Definimos la ruta completa donde se guardar\xe1 el archivo de respaldo. Esto implica obtener la ruta base del proyecto, especificar la ruta relativa a la carpeta de respaldo y combinar ambas para obtener la ruta completa del archivo."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Guardado del Archivo de Respaldo")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"file_put_contents($file_path, $output);\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Finalmente, guardamos el contenido del respaldo en el archivo correspondiente en la ruta que hemos definido. Esto crea el archivo de respaldo en el sistema de archivos.")))),(0,r.kt)("p",null,"Con este comando personalizado, puedes realizar f\xe1cilmente respaldos de tu base de datos desde la l\xednea de comandos de Laravel. Cada paso del proceso se ha explicado detalladamente para que comprendas c\xf3mo funciona y puedas adaptarlo a tus necesidades espec\xedficas."),(0,r.kt)("h3",{id:"ejecuta-tu-comando"},"\xa1Ejecuta tu Comando!"),(0,r.kt)("admonition",{title:"Requisitos",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Antes de ejecutar el comando comprueba que la variable ",(0,r.kt)("strong",{parentName:"p"},"path")," de de su sistema incluye las rutas para poder ejecutar los ficheros ",(0,r.kt)("strong",{parentName:"p"},"mysqldump")," y ",(0,r.kt)("strong",{parentName:"p"},"php.exe"),". Tambi\xe9n deber\xe1 tener creado el directorio ",(0,r.kt)("strong",{parentName:"p"},"app/data")," para realizar las preubas.")),(0,r.kt)("p",null,"Ahora que has creado y registrado tu primer comando personalizado, puedes ejecutarlo desde la terminal. Utiliza el nombre y argumentos que definiste en la firma del comando. Por ejemplo:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"php artisan app:backup-database\n")),(0,r.kt)("p",null,"Despu\xe9s de ejecutar el comando, deber\xedas ver el resultado en la consola."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"C:\\xampp\\htdocs\\cervezas>php artisan app:backup-database\nBackup creado correctamente: backup-05-11-2023-005545.sql\n")),(0,r.kt)("p",null,"\xa1Felicidades! Has creado y ejecutado con \xe9xito tu primer comando personalizado en Laravel. Deber\xedas encontrar el fichero de respaldo dentro de la carpeta ",(0,r.kt)("strong",{parentName:"p"},"app/backup"),"."),(0,r.kt)("h2",{id:"restore-database"},"Restore Database"),(0,r.kt)("p",null,"A continuaci\xf3n vamos a examinar como crear nuestro comando para restaurar nuestra BB.DD."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"<?php\n\nnamespace App\\Console\\Commands;\n\nuse Illuminate\\Console\\Command;\n\nclass RestoreDatabase extends Command\n{\n    /**\n     * The name and signature of the console command.\n     *\n     * @var string\n     */\n    protected $signature = 'app:restore {file : The path to the backup file}';\n\n    /**\n     * The console command description.\n     *\n     * @var string\n     */\n    protected $description = 'Restore a database from a backup file';\n\n    /**\n     * Execute the console command.\n     */\n    public function handle()\n    {\n        $backupFile = $this->argument('file');\n        $database = config('database.connections.mysql.database');\n        $username = config('database.connections.mysql.username');\n        $password = config('database.connections.mysql.password');\n        $host = config('database.connections.mysql.host');\n        $port = config('database.connections.mysql.port');\n        $backupPath = base_path($backupFile);\n\n        $command = \"mysql -u $username -p$password -h $host -P $port $database < $backupPath\";\n\n        // Usar exec para ejecutar el comando\n        exec($command, $output, $returnVar);\n\n        if ($returnVar === 0) {\n            $this->info('Database restored successfully.');\n        } else {\n            $this->error('Database restore failed.');\n        }\n    }\n}\n")),(0,r.kt)("h3",{id:"explicaci\xf3n-del-c\xf3digo"},"Explicaci\xf3n del c\xf3digo:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Declaraci\xf3n de la Clase y Propiedades:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"namespace App\\Console\\Commands;\n\nuse Illuminate\\Console\\Command;\n")),(0,r.kt)("p",{parentName:"li"},"Aqu\xed, estamos declarando un nuevo comando en el espacio de nombres ",(0,r.kt)("inlineCode",{parentName:"p"},"App\\Console\\Commands")," que extiende la clase ",(0,r.kt)("inlineCode",{parentName:"p"},"Command")," de Laravel. Esto proporciona a la clase ",(0,r.kt)("inlineCode",{parentName:"p"},"RestoreDatabase")," todas las funcionalidades necesarias para definir un comando de consola.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Definici\xf3n de la Firma del Comando:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"protected $signature = 'app:restore {file : The path to the backup file}';\n")),(0,r.kt)("p",{parentName:"li"},"Esta propiedad ",(0,r.kt)("inlineCode",{parentName:"p"},"$signature")," define la firma del comando. En este caso, el comando se llama ",(0,r.kt)("inlineCode",{parentName:"p"},"app:restore")," y espera un argumento llamado ",(0,r.kt)("inlineCode",{parentName:"p"},"file")," que representa la ruta al archivo de respaldo. La descripci\xf3n entre llaves (",(0,r.kt)("inlineCode",{parentName:"p"},"{}"),") explica el prop\xf3sito del argumento.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Definici\xf3n de la Descripci\xf3n del Comando:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"protected $description = 'Restore a database from a backup file';\n")),(0,r.kt)("p",{parentName:"li"},"La propiedad ",(0,r.kt)("inlineCode",{parentName:"p"},"$description")," proporciona una descripci\xf3n breve del prop\xf3sito del comando.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"M\xe9todo ",(0,r.kt)("inlineCode",{parentName:"strong"},"handle"),":")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"public function handle()\n{\n    // ...\n}\n")),(0,r.kt)("p",{parentName:"li"},"El m\xe9todo ",(0,r.kt)("inlineCode",{parentName:"p"},"handle")," es el coraz\xf3n del comando. Aqu\xed se define la l\xf3gica que se ejecutar\xe1 cuando el comando sea llamado desde la l\xednea de comandos.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Obtenci\xf3n de Argumentos y Configuraci\xf3n de Variables:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$backupFile = $this->argument('file');\n$database = config('database.connections.mysql.database');\n$username = config('database.connections.mysql.username');\n$password = config('database.connections.mysql.password');\n$host = config('database.connections.mysql.host');\n$port = config('database.connections.mysql.port');\n")),(0,r.kt)("p",{parentName:"li"},"Estas l\xedneas obtienen el valor del argumento ",(0,r.kt)("inlineCode",{parentName:"p"},"file")," proporcionado al comando y configuran algunas variables con los detalles de la base de datos que se utilizar\xe1n para la restauraci\xf3n. Esto incluye el nombre de la base de datos, el nombre de usuario, la contrase\xf1a, el host y el puerto del servidor MySQL.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Creaci\xf3n del Comando MySQL para la Restauraci\xf3n:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$command = "mysql -u $username -p$password -h $host -P $port $database < $backupPath";\n')),(0,r.kt)("p",{parentName:"li"},"Se crea una cadena de comandos MySQL que se utilizar\xe1 para realizar la restauraci\xf3n. Esta cadena utiliza los valores de las variables configuradas anteriormente y la ruta al archivo de respaldo.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Ejecuci\xf3n del Comando con ",(0,r.kt)("inlineCode",{parentName:"strong"},"exec"),":")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"exec($command, $output, $returnVar);\n")),(0,r.kt)("p",{parentName:"li"},"El comando se ejecuta utilizando la funci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"exec"),". El resultado de la ejecuci\xf3n se almacena en el arreglo ",(0,r.kt)("inlineCode",{parentName:"p"},"$output"),", y el valor de retorno se almacena en la variable ",(0,r.kt)("inlineCode",{parentName:"p"},"$returnVar"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Verificaci\xf3n del Resultado de la Ejecuci\xf3n:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-php"},"if ($returnVar === 0) {\n    $this->info('Database restored successfully.');\n} else {\n    $this->error('Database restore failed.');\n}\n")),(0,r.kt)("p",{parentName:"li"},"Se verifica el valor de retorno (",(0,r.kt)("inlineCode",{parentName:"p"},"$returnVar"),"). Si es igual a 0, se muestra un mensaje de \xe9xito utilizando ",(0,r.kt)("inlineCode",{parentName:"p"},"$this->info()"),". Si es distinto de 0, se muestra un mensaje de error utilizando ",(0,r.kt)("inlineCode",{parentName:"p"},"$this->error()"),"."))),(0,r.kt)("p",null,"En definitiva, este comando de Laravel permite restaurar una base de datos utilizando una cadena de comandos de MySQL generada din\xe1micamente a partir de los argumentos y la configuraci\xf3n de la base de datos. El resultado de la ejecuci\xf3n se muestra en la consola como un mensaje de \xe9xito o de error. Esto puede ser \xfatil para automatizar la restauraci\xf3n de bases de datos desde archivos de respaldo en un entorno de desarrollo o producci\xf3n."))}m.isMDXComponent=!0}}]);